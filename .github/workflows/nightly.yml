name: Nightly Maintenance

on:
  workflow_dispatch:
  # schedule:
  #   - cron: '0 0 * * 6' # Weekly on Saturday

jobs:
  nightly-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Check for recent activity
        id: check
        run: |
          if [[ -z $(git log --since="7 days ago") ]]; then
            echo "No changes in last 7 days. Skipping."
            echo "run=false" >> $GITHUB_OUTPUT
          else
            echo "run=true" >> $GITHUB_OUTPUT
          fi

      - name: Run Full Suite
        if: steps.check.outputs.run == 'true'
        uses: ./.github/workflows/ci-orchestrator.yml
        with:
          mode: 'Full'
